"use strict";(()=>{var ae=Object.create;var W=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var q=(m,e)=>()=>(e||m((e={exports:{}}).exports,e),e.exports);var ce=(m,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of he(e))!ue.call(m,a)&&a!==t&&W(m,a,{get:()=>e[a],enumerable:!(n=le(e,a))||n.enumerable});return m};var B=(m,e,t)=>(t=m!=null?ae(de(m)):{},ce(e||!m||!m.__esModule?W(t,"default",{value:m,enumerable:!0}):t,m));var Z=q((F,J)=>{(function(m,e){typeof define=="function"&&define.amd?define([],e):typeof F=="object"?J.exports=e():m.download=e()})(F,function(){return function m(e,t,n){var a=window,g="application/octet-stream",y=n||g,x=e,f=!t&&!n&&x,w=document.createElement("a"),i=function(u){return String(u)},r=a.Blob||a.MozBlob||a.WebKitBlob||i,s=t||"download",o,d;if(r=r.call?r.bind(a):Blob,String(this)==="true"&&(x=[x,y],y=x[0],x=x[1]),f&&f.length<2048&&(s=f.split("/").pop().split("?")[0],w.href=f,w.href.indexOf(f)!==-1)){var c=new XMLHttpRequest;return c.open("GET",f,!0),c.responseType="blob",c.onload=function(u){m(u.target.response,s,g)},setTimeout(function(){c.send()},0),c}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(x))if(x.length>1024*1024*1.999&&r!==i)x=h(x),y=x.type||g;else return navigator.msSaveBlob?navigator.msSaveBlob(h(x),s):v(x);else if(/([\x80-\xff])/.test(x)){var b=0,A=new Uint8Array(x.length),l=A.length;for(b;b<l;++b)A[b]=x.charCodeAt(b);x=new r([A],{type:y})}o=x instanceof r?x:new r([x],{type:y});function h(u){var p=u.split(/[:;,]/),_=p[1],C=p[2]=="base64"?atob:decodeURIComponent,k=C(p.pop()),G=k.length,O=0,K=new Uint8Array(G);for(O;O<G;++O)K[O]=k.charCodeAt(O);return new r([K],{type:_})}function v(u,p){if("download"in w)return w.href=u,w.setAttribute("download",s),w.className="download-js-link",w.innerHTML="downloading...",w.style.display="none",document.body.appendChild(w),setTimeout(function(){w.click(),document.body.removeChild(w),p===!0&&setTimeout(function(){a.URL.revokeObjectURL(w.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,g)),window.open(u)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=u),!0;var _=document.createElement("iframe");document.body.appendChild(_),!p&&/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,g)),_.src=u,setTimeout(function(){document.body.removeChild(_)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(o,s);if(a.URL)v(a.URL.createObjectURL(o),!0);else{if(typeof o=="string"||o.constructor===i)try{return v("data:"+y+";base64,"+a.btoa(o))}catch(u){return v("data:"+y+","+encodeURIComponent(o))}d=new FileReader,d.onload=function(u){v(this.result)},d.readAsDataURL(o)}return!0}})});var ee=q((Se,Y)=>{(function(){"use strict";function m(t,n,a){return t.splice(n,!a||1+a-n+(!(a<0^n>=0)&&(a<0||-1)*t.length)),t.length}let e=function(){let t=[],n=-1,a=0,g=!1,y;function x(f,w){return!f||typeof f[w]!="function"?this:(g=!0,f[w](),g=!1,this)}return{add:function(f){return g?this:(t.splice(n+1,t.length-n),t.push(f),a&&t.length>a&&m(t,0,-(a+1)),n=t.length-1,y&&y(),this)},setCallback:function(f){y=f},undo:function(){let f=t[n];if(!f)return this;let w=f.groupId;for(;f.groupId===w&&(x(f,"undo"),n-=1,f=t[n],!(!f||!f.groupId)););return y&&y(),this},redo:function(){let f=t[n+1];if(!f)return this;let w=f.groupId;for(;f.groupId===w&&(x(f,"redo"),n+=1,f=t[n+1],!(!f||!f.groupId)););return y&&y(),this},clear:function(){let f=t.length;t=[],n=-1,y&&f>0&&y()},hasUndo:function(){return n!==-1},hasRedo:function(){return n<t.length-1},getCommands:function(f){return f?t.filter(w=>w.groupId===f):t},getIndex:function(){return n},setLimit:function(f){a=f}}};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return e}):typeof Y!="undefined"&&Y.exports?Y.exports=e:window.UndoManager=e})()});var ie=q((te,R)=>{(function(){function m(i,r){var s=t("div",null,"qs_label",r);return s.innerHTML=i,s}function e(i,r,s,o){var d=t("input",r,s,o);return d.type=i,d}function t(i,r,s,o){var d=document.createElement(i);if(d)return d.id=r,s&&(d.className=s),o&&o.appendChild(d),d}function n(){return navigator.userAgent.indexOf("rv:11")!=-1||navigator.userAgent.indexOf("MSIE")!=-1}function a(){var i=navigator.userAgent.toLowerCase();return!(i.indexOf("chrome")>-1||i.indexOf("firefox")>-1||i.indexOf("epiphany")>-1)&&i.indexOf("safari/")>-1}function g(){var i=navigator.userAgent.toLowerCase();return i.indexOf("edge")>-1}function y(){var i=document.createElement("style");i.innerText=f,document.head.appendChild(i),x=!0}var x=!1,f=".qs_main{background-color:#dddddd;text-align:left;position:absolute;width:200px;font:12px sans-serif;box-shadow:5px 5px 8px rgba(0,0,0,0.35);user-select:none;-webkit-user-select:none;color:#000000;border:none}.qs_content{background-color:#cccccc;overflow-y:auto}.qs_title_bar{background-color:#eeeeee;user-select:none;-webkit-user-select:none;cursor:pointer;padding:5px;font-weight:bold;border:none;color:#000000}.qs_container{margin:5px;padding:5px;background-color:#eeeeee;border:none;position:relative}.qs_container_selected{border:none;background-color:#ffffff}.qs_range{-webkit-appearance:none;-moz-appearance:none;width:100%;height:17px;padding:0;margin:0;background-color:transparent;border:none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_range:focus{outline:none;border:none}.qs_range::-webkit-slider-runnable-track{width:100%;height:15px;cursor:pointer;background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-webkit-slider-runnable-track{background:#cccccc}.qs_range::-webkit-slider-thumb{-webkit-appearance:none;height:15px;width:15px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer;margin-top:0}.qs_range::-moz-range-track{width:100%;height:15px;cursor:pointer;background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range::-moz-range-thumb{height:15px;width:15px;border:none;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer}.qs_range::-ms-track{width:100%;height:15px;cursor:pointer;visibility:hidden;background:transparent}.qs_range::-ms-thumb{height:15px;width:15px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer;border:none}.qs_range::-ms-fill-lower{background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-ms-fill-lower{background:#cccccc}.qs_range::-ms-fill-upper{background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-ms-fill-upper{background:#cccccc}.qs_button{background-color:#f6f6f6;color:#000000;height:30px;border:1px solid #aaaaaa;font:12px sans-serif}.qs_button:active{background-color:#ffffff;border:1px solid #aaaaaa}.qs_button:focus{border:1px solid #aaaaaa;outline:none}.qs_checkbox{cursor:pointer}.qs_checkbox input{position:absolute;left:-99999px}.qs_checkbox span{height:16px;width:100%;display:block;text-indent:20px;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAALklEQVQ4T2OcOXPmfwYKACPIgLS0NLKMmDVrFsOoAaNhMJoOGBioFwZkZUWoJgApdFaxjUM1YwAAAABJRU5ErkJggg==') no-repeat}.qs_checkbox input:checked+span{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvElEQVQ4T63Tyw2EIBAA0OFKBxBL40wDRovAUACcKc1IB1zZDAkG18GYZTmSmafzgTnnMgwchoDWGlJKheGcP3JtnPceCqCUAmttSZznuYtgchsXQrgC+77DNE0kUpPbmBOoJaBOIVQylnqWgAAeKhDve/AN+EaklJBzhhgjWRoJVGTbNjiOowAIret6a+4jYIwpX8aDwLIs74C2D0IIYIyVP6Gm898m9kbVm85ljHUTf16k4VUefkwDrxk+zoUEwCt0GbUAAAAASUVORK5CYII=') no-repeat}.qs_checkbox_label{position:absolute;top:7px;left:30px}.qs_label{margin-bottom:3px;user-select:none;-webkit-user-select:none;cursor:default;font:12px sans-serif}.qs_text_input{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;width:100%;padding:0 0 0 5px;height:24px;border:1px inset #ffffff;background-color:#ffffff;color:#000000;font-size:12px}.qs_text_input:focus{outline:none;background:#ffffff;border:1px inset #ffffff}.qs_select{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAp0lEQVRIS+2SsQ3FIAwF7RVYhA5mgQFhFuhYhJKWL0eKxI8SGylKZ0p4+OBsHGNM+HChAiS7qkgyBKrovaLeOxhjbgtxZ+cFtgelFMg5QwgBvPd/EO5sDbKAlBLUWo/8CjmL075zDmKMj6rEKbpCqBL9aqc4ZUQAhVbInBMQUXz5Vg/WfxOktXZsWWtZLds9uIqlqaH1NFV3jdhSJA47E1CAaE8ViYp+wGiWMZ/T+cgAAAAASUVORK5CYII=') no-repeat right #f6f6f6;-webkit-appearance:none;-moz-appearance:none;appearance:none;color:#000000;width:100%;height:24px;border:1px solid #aaaaaa;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;padding:0 5px;-moz-outline:none;font-size:14px}.qs_select option{font-size:14px}.qs_select::-ms-expand{display:none}.qs_select:focus{outline:none}.qs_number{height:24px}.qs_image{width:100%}.qs_progress{width:100%;height:15px;background-color:#cccccc;border:none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_progress_value{height:100%;background-color:#999999}.qs_textarea{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;resize:vertical;width:100%;padding:3px 5px;border:1px inset #ffffff;background-color:#ffffff;color:#000000;font-size:12px}.qs_textarea:focus{outline:none;background:#ffffff;border:1px inset #ffffff}.qs_color{position:absolute;left:-999999px}.qs_color_label{width:100%;height:20px;display:block;border:1px solid #aaaaaa;cursor:pointer;padding:0 0 0 5px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_file_chooser{position:absolute;left:-999999px}.qs_file_chooser_label{background-color:#f6f6f6;color:#000000;height:30px;border:1px solid #aaaaaa;font:12px sans-serif;width:100%;display:block;cursor:pointer;padding:7px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}",w={_version:"2.1",_topZ:1,_panel:null,_titleBar:null,_content:null,_startX:0,_startY:0,_hidden:!1,_collapsed:!1,_controls:null,_keyCode:-1,_draggable:!0,_collapsible:!0,_globalChangeHandler:null,useExtStyleSheet:function(){x=!0},create:function(i,r,s,o){var d=Object.create(this);return d._init(i,r,s,o),d},destroy:function(){this._panel.parentElement&&this._panel.parentElement.removeChild(this._panel);for(var i in this)this[i]=null},_init:function(i,r,s,o){x||y(),this._bindHandlers(),this._createPanel(i,r,o),this._createTitleBar(s||"QuickSettings"),this._createContent()},_bindHandlers:function(){this._startDrag=this._startDrag.bind(this),this._drag=this._drag.bind(this),this._endDrag=this._endDrag.bind(this),this._doubleClickTitle=this._doubleClickTitle.bind(this),this._onKeyUp=this._onKeyUp.bind(this)},getValuesAsJSON:function(i){var r={};for(var s in this._controls)this._controls[s].getValue&&(r[s]=this._controls[s].getValue());return i&&(r=JSON.stringify(r)),r},setValuesFromJSON:function(i){typeof i=="string"&&(i=JSON.parse(i));for(var r in i)this._controls[r].setValue&&this._controls[r].setValue(i[r]);return this},saveInLocalStorage:function(i){return this._localStorageName=i,this._readFromLocalStorage(i),this},clearLocalStorage:function(i){return localStorage.removeItem(i),this},_saveInLocalStorage:function(i){localStorage.setItem(i,this.getValuesAsJSON(!0))},_readFromLocalStorage:function(i){var r=localStorage.getItem(i);r&&this.setValuesFromJSON(r)},_createPanel:function(i,r,s){this._panel=t("div",null,"qs_main",s||document.body),this._panel.style.zIndex=++w._topZ,this.setPosition(i||0,r||0),this._controls={}},_createTitleBar:function(i){this._titleBar=t("div",null,"qs_title_bar",this._panel),this._titleBar.textContent=i,this._titleBar.addEventListener("mousedown",this._startDrag),this._titleBar.addEventListener("dblclick",this._doubleClickTitle)},_createContent:function(){this._content=t("div",null,"qs_content",this._panel)},_createContainer:function(){var i=t("div",null,"qs_container");return i.addEventListener("focus",function(){this.className+=" qs_container_selected"},!0),i.addEventListener("blur",function(){var r=this.className.indexOf(" qs_container_selected");r>-1&&(this.className=this.className.substr(0,r))},!0),this._content.appendChild(i),i},setPosition:function(i,r){return this._panel.style.left=i+"px",this._panel.style.top=Math.max(r,0)+"px",this},setSize:function(i,r){return this._panel.style.width=i+"px",this._content.style.width=i+"px",this._content.style.height=r-this._titleBar.offsetHeight+"px",this},setWidth:function(i){return this._panel.style.width=i+"px",this._content.style.width=i+"px",this},setHeight:function(i){return this._content.style.height=i-this._titleBar.offsetHeight+"px",this},setDraggable:function(i){return this._draggable=i,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},_startDrag:function(i){this._draggable&&(this._panel.style.zIndex=++w._topZ,document.addEventListener("mousemove",this._drag),document.addEventListener("mouseup",this._endDrag),this._startX=i.clientX,this._startY=i.clientY),i.preventDefault()},_drag:function(i){var r=parseInt(this._panel.style.left),s=parseInt(this._panel.style.top),o=i.clientX,d=i.clientY;this.setPosition(r+o-this._startX,s+d-this._startY),this._startX=o,this._startY=d,i.preventDefault()},_endDrag:function(i){document.removeEventListener("mousemove",this._drag),document.removeEventListener("mouseup",this._endDrag),i.preventDefault()},setGlobalChangeHandler:function(i){return this._globalChangeHandler=i,this},_callGCH:function(){this._localStorageName&&this._saveInLocalStorage(this._localStorageName),this._globalChangeHandler&&this._globalChangeHandler()},hide:function(){return this._panel.style.visibility="hidden",this._hidden=!0,this},show:function(){return this._panel.style.visibility="visible",this._panel.style.zIndex=++w._topZ,this._hidden=!1,this},toggleVisibility:function(){return this._hidden?this.show():this.hide(),this},setCollapsible:function(i){return this._collapsible=i,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},collapse:function(){return this._panel.removeChild(this._content),this._collapsed=!0,this},expand:function(){return this._panel.appendChild(this._content),this._collapsed=!1,this},toggleCollapsed:function(){return this._collapsed?this.expand():this.collapse(),this},setKey:function(i){return this._keyCode=i.toUpperCase().charCodeAt(0),document.body.addEventListener("keyup",this.onKeyUp),this},_onKeyUp:function(i){i.keyCode===this._keyCode&&this.toggleVisibility()},_doubleClickTitle:function(){this._collapsible&&this.toggleCollapsed()},removeControl:function(i){if(this._controls[i])var r=this._controls[i].container;return r&&r.parentElement&&r.parentElement.removeChild(r),this._controls[i]=null,this},enableControl:function(i){return this._controls[i]&&(this._controls[i].control.disabled=!1),this},disableControl:function(i){return this._controls[i]&&(this._controls[i].control.disabled=!0),this},hideControl:function(i){return this._controls[i]&&(this._controls[i].container.style.display="none"),this},showControl:function(i){return this._controls[i]&&(this._controls[i].container.style.display="block"),this},overrideStyle:function(i,r,s){return this._controls[i]&&(this._controls[i].control.style[r]=s),this},hideTitle:function(i){var r=this._controls[i].label;return r&&(r.style.display="none"),this},showTitle:function(i){var r=this._controls[i].label;return r&&(r.style.display="block"),this},hideAllTitles:function(){for(var i in this._controls){var r=this._controls[i].label;r&&(r.style.display="none")}return this},showAllTitles:function(){for(var i in this._controls){var r=this._controls[i].label;r&&(r.style.display="block")}return this},getValue:function(i){return this._controls[i].getValue()},setValue:function(i,r){return this._controls[i].setValue(r),this._callGCH(),this},addBoolean:function(i,r,s){var o=this._createContainer(),d=t("label",null,"qs_checkbox_label",o);d.textContent=i,d.setAttribute("for",i);var c=t("label",null,"qs_checkbox",o);c.setAttribute("for",i);var b=e("checkbox",i,null,c);b.checked=r,t("span",null,null,c),this._controls[i]={container:o,control:b,getValue:function(){return this.control.checked},setValue:function(l){this.control.checked=l,s&&s(l)}};var A=this;return b.addEventListener("change",function(){s&&s(b.checked),A._callGCH()}),this},bindBoolean:function(i,r,s){return this.addBoolean(i,r,function(o){s[i]=o})},addButton:function(i,r){var s=this._createContainer(),o=e("button",i,"qs_button",s);o.value=i,this._controls[i]={container:s,control:o};var d=this;return o.addEventListener("click",function(){r&&r(o),d._callGCH()}),this},addColor:function(i,r,s){if(a()||g()||n())return this.addText(i,r,s);var o=this._createContainer(),d=m("<b>"+i+":</b> "+r,o),c=e("color",i,"qs_color",o);c.value=r||"#ff0000";var b=t("label",null,"qs_color_label",o);b.setAttribute("for",i),b.style.backgroundColor=c.value,this._controls[i]={container:o,control:c,colorLabel:b,label:d,title:i,getValue:function(){return this.control.value},setValue:function(l){this.control.value=l,this.colorLabel.style.backgroundColor=c.value,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,s&&s(l)}};var A=this;return c.addEventListener("input",function(){d.innerHTML="<b>"+i+":</b> "+c.value,b.style.backgroundColor=c.value,s&&s(c.value),A._callGCH()}),this},bindColor:function(i,r,s){return this.addColor(i,r,function(o){s[i]=o})},addDate:function(i,r,s){var o;if(r instanceof Date){var d=r.getFullYear(),c=r.getMonth()+1;c<10&&(c="0"+c);var b=r.getDate();o=d+"-"+c+"-"+b}else o=r;if(n())return this.addText(i,o,s);var A=this._createContainer(),l=m("<b>"+i+"</b>",A),h=e("date",i,"qs_text_input",A);h.value=o||"",this._controls[i]={container:A,control:h,label:l,getValue:function(){return this.control.value},setValue:function(u){var p;if(u instanceof Date){var _=u.getFullYear(),C=u.getMonth()+1;C<10&&(C="0"+C);var k=u.getDate();k<10&&(k="0"+k),p=_+"-"+C+"-"+k}else p=u;this.control.value=p||"",s&&s(p)}};var v=this;return h.addEventListener("input",function(){s&&s(h.value),v._callGCH()}),this},bindDate:function(i,r,s){return this.addDate(i,r,function(o){s[i]=o})},addDropDown:function(i,r,s){for(var o=this._createContainer(),d=m("<b>"+i+"</b>",o),c=t("select",null,"qs_select",o),b=0;b<r.length;b++){var A=t("option");A.label=r[b],A.innerText=r[b],c.add(A)}var l=this;return c.addEventListener("change",function(){var h=c.selectedIndex,v=c.options;s&&s({index:h,value:v[h].label}),l._callGCH()}),this._controls[i]={container:o,control:c,label:d,getValue:function(){var h=this.control.selectedIndex;return{index:h,value:this.control.options[h].label}},setValue:function(h){var v;v=h.index!=null?h.index:h;var u=this.control.options;this.control.selectedIndex=v,s&&s({index:v,value:u[v].label})}},this},bindDropDown:function(i,r,s){return this.addDropDown(i,r,function(o){s[i]=o.value})},addElement:function(i,r){var s=this._createContainer(),o=m("<b>"+i+"</b>",s);return s.appendChild(r),this._controls[i]={container:s,label:o},this},addFileChooser:function(i,r,s,o){var d=this._createContainer(),c=m("<b>"+i+"</b>",d),b=e("file",i,"qs_file_chooser",d);s&&(b.accept=s);var A=t("label",null,"qs_file_chooser_label",d);A.setAttribute("for",i),A.textContent=r||"Choose a file...",this._controls[i]={container:d,control:b,label:c,getValue:function(){return this.control.files[0]}};var l=this;return b.addEventListener("change",function(){b.files&&b.files.length&&(A.textContent=b.files[0].name,o&&o(b.files[0]),l._callGCH())}),this},addHTML:function(i,r){var s=this._createContainer(),o=m("<b>"+i+":</b> ",s),d=t("div",null,null,s);return d.innerHTML=r,this._controls[i]={label:o,control:d,getValue:function(){return this.control.innerHTML},setValue:function(c){this.control.innerHTML=c}},this},addImage:function(i,r){var s=this._createContainer(),o=m("<b>"+i+"</b>",s);return img=t("img",null,"qs_image",s),img.src=r,this._controls[i]={container:s,control:img,label:o,getValue:function(){return this.control.src},setValue:function(d){this.control.src=d}},this},addRange:function(i,r,s,o,d,c){return this._addNumber("range",i,r,s,o,d,c)},addNumber:function(i,r,s,o,d,c){return this._addNumber("number",i,r,s,o,d,c)},_addNumber:function(i,r,s,o,d,c,b){var A=this._createContainer(),l=m("",A),h=i==="range"?"qs_range":"qs_text_input qs_number",v=e(i,r,h,A);v.min=s||0,v.max=o||100,v.step=c||1,v.value=d||0,l.innerHTML="<b>"+r+":</b> "+v.value,this._controls[r]={container:A,control:v,label:l,title:r,callback:b,getValue:function(){return parseFloat(this.control.value)},setValue:function(_){this.control.value=_,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,b&&b(parseFloat(_))}};var u="input";i==="range"&&n()&&(u="change");var p=this;return v.addEventListener(u,function(){l.innerHTML="<b>"+r+":</b> "+v.value,b&&b(parseFloat(v.value)),p._callGCH()}),this},bindRange:function(i,r,s,o,d,c){return this.addRange(i,r,s,o,d,function(b){c[i]=b})},bindNumber:function(i,r,s,o,d,c){return this.addNumber(i,r,s,o,d,function(b){c[i]=b})},setRangeParameters:function(i,r,s,o){return this.setNumberParameters(i,r,s,o)},setNumberParameters:function(i,r,s,o){var d=this._controls[i],c=d.control.value;return d.control.min=r,d.control.max=s,d.control.step=o,d.control.value!==c&&d.callback&&d.callback(d.control.value),this},addPassword:function(i,r,s){return this._addText("password",i,r,s)},bindPassword:function(i,r,s){return this.addPassword(i,r,function(o){s[i]=o})},addProgressBar:function(i,r,s,o){var d=this._createContainer(),c=m("",d),b=t("div",null,"qs_progress",d),A=t("div",null,"qs_progress_value",b);return A.style.width=s/r*100+"%",o==="numbers"?c.innerHTML="<b>"+i+":</b> "+s+" / "+r:o==="percent"?c.innerHTML="<b>"+i+":</b> "+Math.round(s/r*100)+"%":c.innerHTML="<b>"+i+"</b>",this._controls[i]={container:d,control:b,valueDiv:A,valueDisplay:o,label:c,value:s,max:r,title:i,getValue:function(){return this.value},setValue:function(l){this.value=Math.max(0,Math.min(l,this.max)),this.valueDiv.style.width=this.value/this.max*100+"%",this.valueDisplay==="numbers"?this.label.innerHTML="<b>"+this.title+":</b> "+this.value+" / "+this.max:this.valueDisplay==="percent"&&(this.label.innerHTML="<b>"+this.title+":</b> "+Math.round(this.value/this.max*100)+"%")}},this},setProgressMax:function(i,r){var s=this._controls[i];return s.max=r,s.value=Math.min(s.value,s.max),s.valueDiv.style.width=s.value/s.max*100+"%",s.valueDisplay==="numbers"?s.label.innerHTML="<b>"+s.title+":</b> "+s.value+" / "+s.max:s.valueDisplay==="percent"?s.label.innerHTML="<b>"+s.title+":</b> "+Math.round(s.value/s.max*100)+"%":s.label.innerHTML="<b>"+s.title+"</b>",this},addText:function(i,r,s){return this._addText("text",i,r,s)},_addText:function(i,r,s,o){var d,c=this._createContainer(),b=m("<b>"+r+"</b>",c);i==="textarea"?(d=t("textarea",r,"qs_textarea",c),d.rows=5):d=e(i,r,"qs_text_input",c),d.value=s||"",this._controls[r]={container:c,control:d,label:b,getValue:function(){return this.control.value},setValue:function(l){this.control.value=l,o&&o(l)}};var A=this;return d.addEventListener("input",function(){o&&o(d.value),A._callGCH()}),this},bindText:function(i,r,s){return this.addText(i,r,function(o){s[i]=o})},addTextArea:function(i,r,s){return this._addText("textarea",i,r,s)},setTextAreaRows:function(i,r){return this._controls[i].control.rows=r,this},bindTextArea:function(i,r,s){return this.addTextArea(i,r,function(o){s[i]=o})},addTime:function(i,r,s){var o;if(r instanceof Date){var d=r.getHours();d<10&&(d="0"+d);var c=r.getMinutes();c<10&&(c="0"+c);var b=r.getSeconds();b<10&&(b="0"+b),o=d+":"+c+":"+b}else o=r;if(n())return this.addText(i,o,s);var A=this._createContainer(),l=m("<b>"+i+"</b>",A),h=e("time",i,"qs_text_input",A);h.value=o||"",this._controls[i]={container:A,control:h,label:l,getValue:function(){return this.control.value},setValue:function(u){var p;if(u instanceof Date){var _=u.getHours();_<10&&(_="0"+_);var C=u.getMinutes();C<10&&(C="0"+C);var k=u.getSeconds();k<10&&(k="0"+k),p=_+":"+C+":"+k}else p=u;this.control.value=p||"",s&&s(p)}};var v=this;return h.addEventListener("input",function(){s&&s(h.value),v._callGCH()}),this},bindTime:function(i,r,s){return this.addTime(i,r,function(o){s[i]=o})}};typeof te=="object"&&typeof R=="object"?R.exports=w:typeof define=="function"&&define.amd?define(w):window.QuickSettings=w})()});var re=q((Te,j)=>{"use strict";(function(){"use strict";var m={event:"click",position:"bottom",horizontalOffset:0,verticalOffset:0,data:{}},e=!1,t=null,n="context-menu",a="context-menu-item",g="context-menu-item-disabled",y=function(l){return!!(l&&l.constructor&&l.call&&l.apply)},x=function(l){return typeof l=="string"||l instanceof String},f=function(l){var h=arguments.length;if(h<2||l===null)return l;for(var v=1;v<h;v++){var u=arguments[v];for(var p in u)l[p]=u[p]}return l},w=function(l){var h=[];return typeof jQuery!="undefined"&&l instanceof jQuery?l:l instanceof HTMLElement?[l]:x(l)?document.querySelectorAll(l):l instanceof NodeList?l:h},i=function(l){if(l.stopPropagation(),l.preventDefault(),t=l.target,d(),t.ctxMenu){var h=r(t);document.body.appendChild(h),e=!0,setTimeout(function(){window.addEventListener("click",d),window.addEventListener("resize",d),window.addEventListener("scroll",d),h.style.visibility="visible",s(l,t,h)},1)}},r=function(l){var h,v=document.createElement("div");v.className=n,v.style.visibility="hidden",v.style.display="inline-block";for(h in l.ctxMenu.menu){var u=l.ctxMenu.menu[h],p=document.createElement("div");p.ctxMenu={key:h,enabled:!!u.enabled},p.ctxMenu.enabled?p.className=a:p.className=g,p.innerHTML=u&&u.label?u.label:h,p.ctxMenu.enabled&&(y(u.onSelect)?p.ctxMenu.onSelect=u.onSelect:p.ctxMenu.onSelect=o,p.addEventListener(l.ctxMenu.event,function(_){this.ctxMenu.onSelect(l,this.ctxMenu.key,p,l.ctxMenu.data),d()})),u.title&&(p.title=u.title),v.appendChild(p)}return v},s=function(l,h,v){var u=0,p=0,_=h.getBoundingClientRect(),C=v.getBoundingClientRect(),k="click";h.ctxMenu&&h.ctxMenu.position&&(k=h.ctxMenu.position),k==="bottom"?(u=_.left+h.ctxMenu.horizontalOffset,p=_.bottom+h.ctxMenu.verticalOffset):k==="top"?(u=_.left+h.ctxMenu.horizontalOffset,p=_.top-C.height+h.ctxMenu.verticalOffset):k==="right"?(u=_.left+_.width+h.ctxMenu.horizontalOffset,p=_.top+h.ctxMenu.verticalOffset):k==="left"?(u=_.left-C.width+h.ctxMenu.horizontalOffset,p=_.top+h.ctxMenu.verticalOffset):(u=l.clientX+h.ctxMenu.horizontalOffset,p=l.clientY+h.ctxMenu.verticalOffset),u<0&&(h.ctxMenu.horizontalOffset>=0?u=h.ctxMenu.horizontalOffset:u=0),p<0&&(h.ctxMenu.verticalOffset>=0?p=h.ctxMenu.verticalOffset:p=0),u+C.width>document.body.clientWidth&&(h.ctxMenu.horizontalOffset>=0?u=document.body.clientWidth-C.width:u=document.body.clientWidth-C.width+h.ctxMenu.horizontalOffset),p+C.height>document.body.clientHeight&&(h.ctxMenu.verticalOffset>=0?p=document.body.clientHeight-C.height:p=document.body.clientHeight-C.height+h.ctxMenu.verticalOffset),v.style.left=u+"px",v.style.top=p+"px"},o=function(l,h,v){},d=function(){var l=0,h=document.getElementsByClassName(n);for(window.removeEventListener("click",d),window.removeEventListener("resize",d),window.removeEventListener("scroll",d),l=0;l<h.length;l++)h[l].parentNode.removeChild(h[l]);e=!1},c=function(l,h,v){var u=0,p=w(l);for(u=0;u<p.length;u++)p[u].ctxMenu.menu.hasOwnProperty(h)&&(p[u].ctxMenu.menu[h].enabled=v)},b=function(l){var h,v={type:"item",enabled:!0,label:"",onSelect:function(){},icon:"",title:""};for(h in l){var u=f({},v);l[h]?y(l[h])?l[h]=f(u,{label:h,onSelect:l[h]}):l[h]=f(u,l[h]):l[h]=f(u,{label:h})}return l},A={attach:function(l,h,v){var u=0;h=b(h);var p=f({menu:f({},h)},m,v),_=w(l);for(u=0;u<_.length;u++)_[u].ctxMenu=p,_[u].addEventListener(p.event,i)},display:function(l,h,v){h=b(f({},h));var u=f({menu:f({},h)},m,v);if(l instanceof Event)l.target.ctxMenu=u,i(l);else if(typeof jQuery!="undefined"&&l instanceof jQuery.Event)l.target.ctxMenu=u,i(l);else if(l instanceof HTMLElement){l.ctxMenu=u;var p=l.getBoundingClientRect(),_={target:l,clientX:p.left,clientY:p.top,stopPropagation:function(){},preventDefault:function(){}};i(_)}else console.log(l)},disable:function(l,h){c(l,h,!1)},enable:function(l,h){c(l,h,!0)},close:function(){d()},isOpen:function(){return e}};typeof window.define=="function"&&window.define.amd!==void 0?window.define("ContextMenu",[],function(){return A}):typeof j!="undefined"&&j.exports!==void 0?j.exports=A:window.ContextMenu=A})()});var Q="2.0.1";function D(m,e){return parseFloat(m.toFixed(e))}function $(m,e=400,t=300){window.open(m,"_blank",`width=${e},height=${t}`)}var M=class m{constructor(e=0,t=0){this.x=e;this.y=t}set(e,t){return this.x=e,this.y=t,this}static fromObject(e){return new m(e.x,e.y)}static dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static swap(e,t,n){let a=e[n];e[n]=t[n],t[n]=a}isEmpty(){return!this.x&&!this.y}oneIsEmpty(){return!this.x||!this.y}sum(e){return new m(this.x+e.x,this.y+e.y)}add(e){return this.x+=e.x,this.y+=e.y,this}diff(e){return new m(this.x-e.x,this.y-e.y)}sub(e){return this.x-=e.x,this.y-=e.y,this}move(e){this.add(e)}getPosition(){return this}setPosition(e){return this.set(e.x,e.y),this}clone(){return new m(this.x,this.y)}invert(){return new m(-this.x,-this.y)}toStr(e,t,n){return D(this[t]*n,e).toString()}toHtml(e,t=1){return this.toStr(e,"x",t)+","+this.toStr(e,"y",t)}};var S=class{constructor(e,t=[],n="",a="",g=0){this.shape=e;this.coords=t;this.href=n;this.title=a;this.id=g}static fromObject(e){switch(e.shape){case"rect":let t=e;return new H(t.coords.map(M.fromObject),t.href,t.title,t.id);case"circle":let n=e;return new I(n.coords.map(M.fromObject),n.radius,n.href,n.title,n.id);case"poly":let a=e;return new E(a.coords.map(M.fromObject),a.href,a.title,a.id,a.closed);case"default":let g=e;return new P(g.iMap,g.href,g.title);default:throw"Not an area"}}getId(){return this.id}setShape(e){return this.shape=e,this}getShape(){return this.shape}addCoord(e){return this.coords.push(e)}setCoords(e){return this.coords=e,this}getCoords(){return this.coords}drawingCoords(){return this.coords.slice()}getPoints(){return this.coords}isEmpty(){return this.coords.length==0}equals(e){return this.id==e.id}copyCoords(){let e=[];return this.coords.forEach((t,n)=>{e[n]=new M(t.x,t.y)}),e}updateLastCoord(e){return this.coords[this.coords.length-1]=e,this}move(e){let t=this.firstCoord();e!=null&&t.add(e)}getPosition(){return this.firstCoord()}setPosition(e){let t=this.coords[0].diff(e);this.move(t)}isValidShape(){return this.isDrawable()}isOverPoint(e,t){let n=this.getPoints().find(a=>M.dist(e,a)<t);return n||!1}setHref(e){return this.href=e,this}getHref(){return this.href}getHrefVerbose(){return this.href===""?"undefined":this.href}setTitle(e){return this.title=e,this}getTitle(){return this.title}setId(e){return this.id=e,this}firstCoord(){return this.coords[0]}htmlCoords(e,t){return this.drawingCoords().map(n=>n.toHtml(e,t)).join(",")}toHtml(e=1){let t=this.htmlCoords(0,e);t=t?`coords="${t}"`:"";let n=this.href?`href="${this.href}"`:"nohref",a=this.title?`title="${this.title}"`:"";return`<area shape="${this.shape}" ${t} ${n} alt="${this.href}" ${a} />`}toSvg(e=1){return`<a xlink:href="${this.href}">${this.svgArea(e)}</a>`}toImf(e=1,t=0){let n=this.htmlCoords(0,e);n=n?`objectCoordinates="${n}"`:"";let a=this.title?`icnObjectTitle="${this.title}"`:"",g="000"+t;return g=g.substring(g.length-3),`<icnObject icnObjectIdent="hot-${g}" ${n} ${a} icnObjectType="${this.shape}"/>`}},T=class extends S{constructor(){super("empty")}isDrawable(){return!1}svgArea(e){return""}isOver(e){return!1}display(e){}},I=class extends S{constructor(t=[],n=0,a="",g="",y=0){super("circle",t,a,g,y);this.radius=n}getCenter(){return this.firstCoord()}isValidShape(){return super.isValidShape()&&this.radius>0}isDrawable(){return this.coords.length==1}isOver(t){let n=this.getCenter();return M.dist(t,n)<this.radius}updateLastCoord(t){let n=this.getCenter();return this.radius=M.dist(n,t),this}display(t){t.ellipse(this.getCenter().x,this.getCenter().y,this.radius*2)}htmlCoords(t,n){return this.getCenter().toHtml(t,n)+","+D(this.radius,t)}svgArea(t){let n=this.coords[0].toStr(0,"x",t),a=this.coords[0].toStr(0,"y",t),g=D(this.radius,0);return`<circle cx="${n}" cy="${a}" r="${g}" />`}},E=class extends S{constructor(t=[],n="",a="",g=0,y=!1){super("poly",t,n,a,g);this.closed=y}isDrawable(){return this.coords.length>=2}isValidShape(){return super.isValidShape()&&this.closed}isOver(t){let n=t.x,a=t.y,g=this.coords.map(s=>s.x),y=this.coords.map(s=>s.y),x,f=g.length-1,w=0,i=g,r=y;for(x=0;x<g.length;x++)(r[x]<a&&r[f]>=a||r[f]<a&&r[x]>=a)&&(i[x]<=n||i[f]<=n)&&(w^=i[x]+(a-r[x])/(r[f]-r[x])*(i[f]-i[x])<n?1:0),f=x;return!!w}isClosable(t,n){let a=M.dist(t,this.firstCoord());return this.coords.length>=4&&a<n}drawingCoords(){let t=super.drawingCoords();return this.closed&&t.push(this.firstCoord()),t}close(){return this.closed=!0,this.coords.pop(),this}move(t){this.coords.map(n=>n.add(t))}display(t){t.beginShape(),this.drawingCoords().forEach(n=>t.vertex(n.x,n.y)),t.endShape()}svgArea(t){return`<polygon points="${this.drawingCoords().map(a=>a.toStr(0,"x",t)+","+a.toStr(0,"y",t)).join(" ")}" />`}},H=class extends E{constructor(e=[],t="",n="",a=0){if(super(e,t,n,a,!0),this.coords.length>0&&this.coords.length<4){let g=this.firstCoord();this.coords=[g,g.clone(),g.clone(),g.clone()]}}isValidShape(){return super.isValidShape()&&!this.isNullArea()}isNullArea(){return this.coords[0].x==this.coords[1].x||this.coords[0].y==this.coords[3].y}updateLastCoord(e){return this.coords[1].x=e.x,this.coords[2]=e,this.coords[3].y=e.y,this}},P=class extends S{constructor(t,n="",a=""){super("default",[],n,a);this.iMap=t;this.isDefault=!0}isDrawable(){return!0}isOver(){return!0}display(t){t.rect(0,0,this.iMap.width-1,this.iMap.height-1)}svgArea(t){return'<rect x="0" y="0" width="100%" height="100%" />'}};var V=class{constructor(e,t,n=[],a="",g=!1){this.width=e;this.height=t;this.areas=n;this.name=a;this.hasDefaultArea=g;this.dArea=new P(this);this.lastId=0}setFromObject(e){let t=e;return t.dArea.iMap=this,this.width=t.width,this.height=t.height,this.areas=t.areas.map(S.fromObject),this.name=t.name,this.hasDefaultArea=t.hasDefaultArea,this.dArea=S.fromObject(t.dArea),this}setName(e){return e&&(this.name=e.replace(/\s+/g,"")),this}getName(){return this.name}setSize(e,t){return this.width=e,this.height=t,this}setDefaultArea(e){return this.hasDefaultArea=e,this}getAreas(e=!0){let t=this.areas.slice();return e&&this.hasDefaultArea&&t.push(this.dArea),t}isEmpty(){return this.getAreas().length==0}addArea(e,t=!0){return t&&e.setId(this.getNewId()),this.areas.unshift(e),e.id}rmvArea(e){let t=this.areaIndex(e);return this.areas.splice(t,1),t}moveArea(e,t){let n=this.areaIndex(e),a=this.areas[n],g=n+t;return g<0||g>=this.areas.length?!1:(this.rmvArea(e),this.insertArea(a,g),g)}shiftArea(){return this.areas.shift()}popArea(){return this.areas.pop()}insertArea(e,t){return this.areas.splice(t,0,e),this.areas.length}areaIndex(e){return this.areas.findIndex(t=>t.id==e)}isFirstArea(e){return this.areaIndex(e)==0}isLastArea(e){return this.areaIndex(e)==this.areas.length-1}getNewId(){return this.lastId++,this.lastId}toHtml(e=1){let t=[];return this.getAreas().forEach(n=>{n.isValidShape()&&t.push("	"+n.toHtml(e))}),'<map name="'+this.name+'" id="'+this.name+`">
`+t.join(`
`)+`
</map>`}toImf(e=1){let t=[];return this.getAreas().forEach((n,a)=>{n.isValidShape()&&t.push("	"+n.toImf(e,a+1))}),`<icnObjectGroup>
`+t.join(`
`)+`
</icnObjectGroup>`}toSvg(e=1){let t=[];this.getAreas(!1).forEach(a=>{a.isValidShape()&&t.push("	"+a.toSvg(e))});let n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+`">
`;return n+=t.join(`
`),n+=`
</svg>`,n}clearAreas(){return this.areas=[],this}setAreas(e){return this.areas=e,this}makeid(e){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,g=0;for(;g<e;)t+=n.charAt(Math.floor(Math.random()*a)),g+=1;return t}};var N=class{constructor(e,t=15,n=0,a=!1){this.iMap=e;this.speed=t;this.alpha=n;this.over=a}appear(){this.over=!0}disappear(){this.over=!1}display(){this.over?this.alpha<100&&(this.alpha+=this.speed):this.alpha>0&&(this.alpha-=this.speed),this.iMap.p5.noStroke(),this.iMap.p5.fill(255,255,255,this.alpha),this.iMap.p5.rect(this.iMap.trueX(0),this.iMap.trueY(0),this.iMap.p5.width/this.iMap.view.scale,this.iMap.p5.height/this.iMap.view.scale)}};var z=class{constructor(){this.origin=new M;this.position=this.origin.clone();this.areas=new Map;this.points=new Map}resetOrigin(e=new M){this.origin=e.clone(),this.position=e,this.addPoint(e)}registerArea(e){this.areas.set(e.getId(),e)}addArea(e){this.registerArea(e),e.getCoords().forEach(t=>this.addPoint(t))}addPoint(e){let t=this.points.get(e)||0;this.points.set(e,t+1)}containsArea(e){return this.areas.has(e.getId())}containsPoint(e){return this.points.has(e)}distToOrigin(){return this.getPosition().diff(this.origin)}clear(){this.areas.clear(),this.points.clear(),this.origin=new M}isEmpty(){return this.points.size==0}move(e){this.points.forEach((t,n)=>{n.move(e)})}getPosition(){return this.position}setPosition(e){let t=e.diff(this.position);this.move(t)}};var ne=B(Z()),se=B(ee()),oe=B(ie()),L=B(re());var U=class{constructor(e,t){this.version=e;this.map=t}},X=class{constructor(e,t=600,n=600){this.menu={SetUrl:{onSelect:(e,t,n,a)=>{this.setAreaUrl(a)},label:"Set url"},SetTitle:{onSelect:(e,t,n,a)=>{this.setAreaTitle(a)},label:"Set title"},Delete:(e,t,n,a)=>{this.deleteArea(a)},MoveFront:{onSelect:(e,t,n,a)=>{this.moveArea(a,-1)},enabled:!0,label:"Move Forward"},MoveBack:{onSelect:(e,t,n,a)=>{this.moveArea(a,1)},enabled:!0,label:"Move Backward"}};let a=document.getElementById(e);if(!a)throw new Error("HTMLElement not found");this.width=t,this.height=n,this.tool="circle",this.drawingTools=["rectangle","circle","polygon"],this.settings,this.tempArea=new T,this.selection=new z,this.hoveredArea=null,this.hoveredPoint=null,this.map=new V(t,n),this.undoManager=new se.default,this.img={data:null,file:null},this.view={scale:1,transX:0,transY:0},this.zoomParams={min:.03,max:3,sensativity:.001},this.magnetism=!0,this.fusion=!1,this.tolerance=6,this.bgLayer=new N(this),this.p5=new p5(this.sketch.bind(this),a)}sketch(e){this.p5=e,e.setup=this.setup.bind(this),e.draw=this.draw.bind(this),e.mousePressed=this.mousePressed.bind(this),e.mouseDragged=this.mouseDragged.bind(this),e.mouseReleased=this.mouseReleased.bind(this),e.mouseWheel=this.mouseWheel.bind(this),e.keyPressed=this.keyPressed.bind(this)}setup(){this.p5.createCanvas(this.width,this.height).drop(this.handeFile.bind(this)).dragLeave(this.onLeave.bind(this)).dragOver(this.onOver.bind(this)),this.settings=oe.default.create(this.p5.width+5,0,"Image-map Creator",this.p5.canvas.parentElement).setDraggable(!1).addText("Map Name","",t=>{this.map.setName(t)}).addDropDown("Tool",["circle","rectangle","polygon","select","delete","test"],t=>{this.setTool(t.value)}).addBoolean("Default Area",this.map.hasDefaultArea,t=>{this.setDefaultArea(t)}).addButton("Undo",this.undoManager.undo).addButton("Redo",this.undoManager.redo).addButton("Clear",this.clearAreas.bind(this)).addButton("Generate Html",()=>{this.settings.setValue("Output",this.map.toHtml())}).addButton("Generate Svg",()=>{this.settings.setValue("Output",this.map.toSvg())}).addButton("Generate Imf",()=>{this.settings.setValue("Output",this.map.toImf())}).addTextArea("Output").addButton("Save",this.save.bind(this)),this.p5.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),this.p5.canvas.addEventListener("mousedown",t=>{t.preventDefault()}),document.getElementById("Output").setAttribute("onFocus","this.select();")}draw(){this.updateTempArea(),this.updateHovered(),this.setCursor(),this.setOutput(),this.setBackground(),this.setTitle(this.hoveredArea),this.p5.translate(this.view.transX,this.view.transY),this.p5.scale(this.view.scale),this.drawImage(),this.bgLayer.display(),this.drawAreas()}mousePressed(){if(this.mouseIsHoverSketch()){let e=this.drawingCoord();if(this.p5.mouseButton==this.p5.LEFT&&!L.isOpen())switch(this.tool){case"circle":case"rectangle":this.setTempArea(e);break;case"polygon":let t=this.tempArea;t.isEmpty()?this.setTempArea(e):t.isClosable(this.mCoord(),this.tolerance/this.view.scale)?(t.close(),t.isValidShape()&&this.createArea(t),this.tempArea=new T):this.tempArea.addCoord(this.mCoord());break;case"select":this.hoveredPoint!==null?(this.selection.addPoint(this.hoveredPoint),this.selection.registerArea(this.hoveredArea),this.selection.resetOrigin(this.hoveredPoint)):this.hoveredArea!==null&&(this.selection.addArea(this.hoveredArea),this.selection.resetOrigin(this.mCoord()));break}}}mouseDragged(){if(this.mouseIsHoverSketch()&&!L.isOpen())if(this.p5.mouseButton==this.p5.LEFT)switch(this.tool){case"select":this.selection.setPosition(this.drawingCoord());break}else this.p5.mouseButton==this.p5.CENTER&&(this.view.transX+=this.p5.mouseX-this.p5.pmouseX,this.view.transY+=this.p5.mouseY-this.p5.pmouseY)}mouseReleased(e){switch(this.tool){case"rectangle":case"circle":this.tempArea.isValidShape()&&this.createArea(this.tempArea),this.tempArea=new T;break;case"select":let t=this.selection;if(!t.isEmpty()){let n=this.selection.distToOrigin();this.undoManager.add({undo:()=>t.move(n.invert()),redo:()=>t.move(n)})}this.selection=new z;break}this.onClick(e),this.bgLayer.disappear()}mouseWheel(e){if(this.mouseIsHoverSketch()){let t=this.view.scale*this.zoomParams.sensativity*-e.deltaY;return this.zoom(t),!1}return!0}keyPressed(e){if(e.composed&&e.ctrlKey){switch(e.key){case"s":this.save();break;case"z":this.undoManager.undo();break;case"y":this.undoManager.redo();break;default:return!0}return!1}else if(this.tool=="polygon"&&e.keyCode==this.p5.ESCAPE)return this.tempArea=new T,!1;return!0}trueX(e){return(e-this.view.transX)/this.view.scale}trueY(e){return(e-this.view.transY)/this.view.scale}mX(){return this.trueX(this.p5.mouseX)}mY(){return this.trueY(this.p5.mouseY)}mCoord(){return new M(this.mX(),this.mY())}drawingCoord(){let e=this.mCoord();return e=this.magnetism&&this.hoveredPoint?this.hoveredPoint:e,this.fusion||(e=e.clone()),e}mouseIsHoverSketch(){return this.p5.mouseX<=this.p5.width&&this.p5.mouseX>=0&&this.p5.mouseY<=this.p5.height&&this.p5.mouseY>=0}updateHovered(){this.hoveredPoint=null;let t=this.map.getAreas().find(n=>{if(this.selection.containsArea(n))return!1;if(this.tool!="test"){let a=n.isOverPoint(this.mCoord(),this.tolerance/this.view.scale);if(a&&!this.selection.containsPoint(a))return this.hoveredPoint=a,!0}return!!n.isOver(this.mCoord())});this.p5.mouseIsPressed||(this.hoveredArea=t||null)}onClick(e){if(this.mouseIsHoverSketch()&&this.hoveredArea){if(this.p5.mouseButton==this.p5.RIGHT)this.selection.addArea(this.hoveredArea),this.menu.MoveFront.enabled=!(this.map.isFirstArea(this.hoveredArea.id)||this.hoveredArea.getShape()=="default"),this.menu.MoveBack.enabled=!(this.map.isLastArea(this.hoveredArea.id)||this.hoveredArea.getShape()=="default"),L.display(e,this.menu,{position:"click",data:this.hoveredArea});else if(this.p5.mouseButton==this.p5.LEFT&&!L.isOpen())switch(this.tool){case"test":$(this.hoveredArea.getHref());break;case"delete":this.deleteArea(this.hoveredArea);break}}this.selection.clear()}onOver(e){this.bgLayer.appear(),e.preventDefault()}onLeave(){this.bgLayer.disappear()}handeFile(e){e.type=="image"?(this.img.data=this.p5.loadImage(e.data,t=>this.resetView(t)),this.img.file=e.file,this.map.getName()||(this.map.setName(e.name),this.settings.setValue("Map Name",this.map.getName()))):e.subtype=="json"&&fetch(e.data).then(t=>t.blob()).then(t=>{let n=new FileReader;n.onload=()=>{let a=n.result;typeof a=="string"&&this.importMap(a)},n.readAsText(t)}),this.bgLayer.disappear()}resetView(e){this.view.scale=1,this.view.transX=0,this.view.transY=0;let t=this.p5.width/e.width,n=this.p5.height/e.height;t<this.view.scale&&(this.view.scale=t),n<this.view.scale&&(this.view.scale=n),this.map.setSize(e.width,e.height)}zoom(e){let t=this.view.scale+e;if(t>this.zoomParams.min&&t<this.zoomParams.max){let n=this.mX(),a=this.mY(),g=n*e,y=a*e;this.view.scale=t,this.view.transX-=g,this.view.transY-=y}}drawImage(){this.img.data&&this.p5.image(this.img.data,0,0,this.img.data.width,this.img.data.height)}drawAreas(){let e=[this.tempArea].concat(this.map.getAreas());for(let t=e.length;t--;){let n=e[t];this.setAreaStyle(n),n.isDrawable()&&n.display(this.p5)}if(this.hoveredPoint){let t=this.hoveredPoint;this.p5.fill(0),this.p5.noStroke(),this.p5.ellipse(t.x,t.y,6/this.view.scale)}}setTool(e){this.tool=e,this.tempArea=new T}setCursor(){if(this.drawingTools.includes(this.tool))switch(this.tool){case"polygon":let e=this.tempArea;if(!e.isEmpty()&&e.isClosable(this.mCoord(),5/this.view.scale)){this.p5.cursor(this.p5.HAND);break}default:this.p5.cursor(this.p5.CROSS)}else if(this.p5.cursor(this.p5.ARROW),this.hoveredArea)switch(this.tool){case"test":case"delete":this.p5.cursor(this.p5.HAND);break;case"select":this.hoveredPoint||this.p5.cursor(this.p5.MOVE);break}}setOutput(){switch(this.tool){case"test":case"select":if(this.mouseIsHoverSketch()){let e=this.hoveredArea?this.hoveredArea.getHrefVerbose():"none";this.settings.setValue("Output",e)}break}}setBackground(){this.p5.background(200),this.img.data||(this.p5.noStroke(),this.p5.fill(0),this.p5.textAlign(this.p5.CENTER,this.p5.CENTER),this.p5.textSize(15),this.p5.text("Drag and drop an image and/or a .map.json save file here",this.p5.width/2,this.p5.height/2))}setTitle(e){this.tool=="test"&&e&&e.getTitle()?this.p5.canvas.setAttribute("title",e.getTitle()):this.p5.canvas.removeAttribute("title")}setAreaStyle(e){let t=this.p5.color(255,255,255,178);this.tool=="test"&&(t=this.p5.color(255,0)),((this.tool=="delete"||this.tool=="select")&&this.mouseIsHoverSketch()&&e==this.hoveredArea||this.selection.containsArea(e))&&(t=this.p5.color(255,200,200,178)),this.p5.fill(t),this.p5.strokeWeight(1/this.view.scale),this.tool=="test"?this.p5.noStroke():this.p5.stroke(0)}setTempArea(e){let t=[e];switch(this.tool){case"rectangle":this.tempArea=new H(t);break;case"circle":this.tempArea=new I(t);break;case"polygon":this.tempArea=new E(t),this.tempArea.addCoord(e);break}}updateTempArea(){let e=this.drawingCoord();this.tempArea.isEmpty()||this.tempArea.updateLastCoord(e)}exportMap(){return JSON.stringify(new U(Q,this.map),function(e,t){return t instanceof V&&!(this instanceof U)?t.getName():t})}save(){let e=new Blob([this.exportMap()],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"});(0,ne.default)(e,`${this.map.getName()}.map.json`,"application/json")}importMap(e){let n=JSON.parse(e).map;this.map.setFromObject(n),this.settings.setValue("Map Name",n.name),this.settings.setValue("Default Area",n.hasDefaultArea),this.reset()}createArea(e){this.map.addArea(e),this.undoManager.add({undo:()=>e=this.map.shiftArea(),redo:()=>this.map.addArea(e,!1)})}deleteArea(e){let t=e.id;if(t===0)this.settings.setValue("Default Area",!1);else{let n=this.map.rmvArea(t);this.undoManager.add({undo:()=>this.map.insertArea(e,n),redo:()=>this.map.rmvArea(t)})}}moveArea(e,t){this.map.moveArea(e.id,t)!==!1&&this.undoManager.add({undo:()=>this.map.moveArea(e.id,-t),redo:()=>this.map.moveArea(e.id,t)})}setAreaUrl(e){let t=e.getHref(),n=prompt("Enter the pointing url of this area",t||"http://");n&&(e.setHref(n),this.undoManager.add({undo:()=>e.setHref(t),redo:()=>e.setHref(n)}))}setAreaTitle(e){let t=e.getTitle(),n=prompt("Enter the title of this area",t||"");n&&(e.setTitle(n),this.undoManager.add({undo:()=>e.setTitle(t),redo:()=>e.setTitle(n)}))}setDefaultArea(e){this.map.setDefaultArea(e),this.undoManager.add({undo:()=>{this.map.setDefaultArea(!e),this.settings.setValue("Default Area",!e)},redo:()=>{this.map.setDefaultArea(e),this.settings.setValue("Default Area",e)}})}clearAreas(){let e=this.map.getAreas(!1);this.map.clearAreas(),this.undoManager.add({undo:()=>this.map.setAreas(e),redo:()=>this.map.clearAreas()})}reset(){this.undoManager.clear()}};globalThis.imageMapCreator=X;})();
//# sourceMappingURL=image-map-creator.min.js.map
